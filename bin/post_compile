#!/usr/bin/env bash
set -eo pipefail

echo "-----> This is a special version of the post-compile hook"
echo "       for faking migrations. Use with caution!"

echo "-----> I'm post-compile hook"
cd ./tabbycat/

echo "-----> Faking database migration"
python manage.py migrate --noinput --fake

echo "-----> Clearing application cache"
python manage.py clearcache

echo "-----> Running dynamic preferences checks"
python manage.py checkpreferences

echo "-----> Running gulp compilation"
npm run gulp build

echo "-----> Running whitenoise static files compilation"
python manage.py collectstatic --noinput

echo "-----> Post-compile done"
