{% extends "base.html" %}
{% load debate_tags %}
{% load static %}

{% block page-title %}Reply Standings after {{ round.name }}{% endblock %}
{% block head-title %}Reply Standings{% endblock %}
{% block sub-title %}after {{ round.name }}{% endblock %}

{% block page-subnav-sections %}
  <a class="btn btn-default" href="{% round_url standings-index current_round %}">
    Standings Overview
  </a>
  <a class="btn btn-default" href="{% round_url standings-team current_round %}">
    Team Standings
  </a>
  {% if pref.enable_divisions %}
  <a class="btn btn-default" href="{% round_url standings-division current_round %}">
    Divisions Standings
  </a>
  {% endif %}
  <a class="btn btn-default" href="{% round_url standings-speaker current_round %}">
    Speaker Standings
  </a>
  {% if pref.show_novices %}
    <a class="btn btn-default" href="{% round_url standings-novice current_round %}">
      Novices Standings
    </a>
  {% endif %}
  {% if pref.reply_scores_enabled %}
    <a class="btn btn-default active" href="{% round_url standings-reply current_round %}">
      Replies Standings
    </a>
  {% endif %}
  <a class="btn btn-default" href="{% round_url standings-motion current_round %}">
    Motion Balance
  </a>
  {% include "tables/table_search.html" %}
{% endblock %}

{% block content %}
<div class="panel panel-default">
  <div class="panel-body">
    <table id="dataTable" class="table" cellspacing="0" cellpadding="0">
    <thead>
      <tr>
        <th class="hidden"></th>
        <th><span data-toggle="tooltip" title="Ranking" class="glyphicon glyphicon-signal"></span></th>
        <th>Name</th>
        {% if pref.show_novices %}
          <th><span class="glyphicon glyphicon-leaf" data-toggle="tooltip" title="Speaker's Novice Status"></span></th>
        {% endif %}
        {% if pref.show_emoji %}
          <th class="team-emoji"></th>
        {% endif %}
        <th>Team</th>
        {% if pref.show_institutions %}
          <th>Institution</th>
        {% endif %}
        {% for round in rounds %}
          <th>{{ round.abbreviation }}</th>
        {% endfor %}
        <th>Av<span class="hidden-xs">erage</span></th>
        <th>Replies Given</th>
      </tr>
    </thead>
    <tbody>
    {% for speaker in speakers %}
      {% with speakers|next_value:forloop.counter0 as next_value %}
      {% with speakers|prev_value:forloop.counter0 as prev_value %}
      <tr class="{% if not speaker.results_in %}danger{% endif%}">
        <td class="hidden">{{ speaker.rank }}</td>
        <td>
          <strong>
          {{ speaker.rank }}{% if next_value.rank == speaker.rank or prev_value.rank == speaker.rank %}<span class="text-muted">=</span>{% endif %}
          </strong>
        </td>
        <td>
          {{ speaker.name }}
        </td>
        {% if pref.show_novices %}
          <td>{% if speaker.novice %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>{% endif %}</td>
        {% endif %}
        {% if pref.show_emoji %}
          <td class="team-emoji">
            <span class="emoji">{{ speaker.team.emoji }}</span>
          </td>
        {% endif %}
        <td>
          {% include "tables/team.html" with team=speaker.team %}
        </td>
        {% if pref.show_institutions %}
          <td>{{ speaker.team.institution.code }}</td>
        {% endif %}
        {% for score in speaker.scores %}
          <td>
            {{ score|stringformat:".2f" }}
          </td>
        {% endfor %}
        <td>
          {{ speaker.average|stringformat:".2f" }}
        </td>
        <td>
          {{ speaker.replies_given }}
        </td>
      </tr>
      {% endwith %}
      {% endwith %}
    {% endfor %}
    </tbody>
  </table>
  </div>
</div>
{% endblock content %}

{% block extra-js %}
  <script type="text/javascript" charset="utf-8">

    $(document).ready( function() {
      var dTable = $("#dataTable").DataTable({
        "aaSorting": [[1, "asc"]],
        "aoColumnDefs": [
          {"iDataSort": 0, "aTargets": [1] }, //sort based on a hidden column when another column is clicked
          { "bVisible": false, "aTargets": [0] }, //set column visibility
        ]
      });
      new $.fn.dataTable.FixedHeader( dTable, {alwaysCloneTop: true});
      $('#table-search').keyup(function(){
        dTable.search($(this).val()).draw();
      });

    } );

  </script>
{% endblock extra-js %}
