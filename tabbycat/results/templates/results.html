{% extends "base_vue_table.html" %}
{% load humanize debate_tags i18n %}

{% block page-title %}{% trans "Enter Results" %}{% endblock %}
{% block head-title %}<span class="emoji">ðŸ“©</span> {% trans "Enter Results" %}{% endblock %}

{% block page-subnav-sections %}
  {% if user.is_superuser %}
    <a href="{% roundurl 'motions-edit' %}" class="btn btn-outline-primary">
      <i data-feather="chevron-left"></i> {% trans "Edit Motions" %}
    </a>
    <a class="btn btn-outline-primary " href="{% roundurl 'results-ballot-checkin' round %}">
      {% trans "Check In Ballots" %}
    </a>
  {% endif %}

{% endblock %}

{% block page-subnav-actions %}
  {% if user.is_superuser and round.seq < tournament.round_set.count and current_round == round %}
    <a class="btn {% if stats.none == 0 and stats.draft == 0  %}btn-outline-success{% else %}btn-danger disabled{% endif %} " href="{% roundurl 'tournament-advance-round-check' %}">
      {% trans "Advance to Next Round" %} <i data-feather="chevron-right"></i>
    </a>
  {% endif %}
{% endblock %}

{% block page-alerts %}
  {% if pref.enable_motions and round.motion_set.count == 0 %}
    {% roundurl 'motions-edit' current_round as motions_url %}
    {% blocktrans trimmed asvar text %}
      Currently there are no motions entered for this round, so debate results
      cannot be entered. <a href="{{ motions_url }}" class="alert-link">Add Motions.</a>
    {% endblocktrans %}
    {% include "components/item-alert.html" with type="danger" %}
  {% endif %}

  {% with sides_unconfirmed=round.num_debates_with_sides_unconfirmed %}
    {% if sides_unconfirmed > 0 and pref.draw_side_allocations != 'manual-ballot' %}
      {% blocktrans trimmed asvar text count ndebates=sides_unconfirmed %}
        One debate does not have its sides confirmed. Results for this debate cannot be entered until its side allocations are marked as confirmed.
      {% plural %}
        {{ ndebates }} debate do not have their sides confirmed. Results for these debates cannot be entered until their side allocations are marked as confirmed.
      {% endblocktrans %}
      {% include "components/item-alert.html" with type="danger" %}
    {% endif %}
  {% endwith %}

  {% with num_even_panel=round.num_debates_with_even_panel %}
    {% if pref.ballots_per_debate == 'per-adj' and num_even_panel > 0 %}
      {% blocktrans trimmed asvar text count num_even_panel=num_even_panel %}
         One debate has a panel with an even number of voting adjudicators. If the adjudicators split evenly, the debate will be awarded to the team for which the chair voted.
      {% plural %}
        {{ num_even_panel }} debates have panels with an even number of voting adjudicators. If the adjudicators split evenly, the debate will be awarded to the team for which the chair voted.
      {% endblocktrans %}
      {% include "components/item-alert.html" with type="warning" %}
    {% endif %}
  {% endwith %}
{% endblock %}

{% block content %}

  <div class="row mb-4">

    <div class="col-md-3 col-12">
      <span class="btn btn-block btn-primary disabled">
        {{ stats.ballot_in }} {% trans "Checked In" %} <i data-feather="inbox"></i>
      </span>
    </div>
    <div class="col-md-3 col-12">
      <span class="btn btn-block btn-danger disabled">
        {{ stats.none }} {% trans "Unknown" %} <i data-feather="x"></i>
       </span>
    </div>
    <div class="col-md-3 col-12">
      <span class="btn btn-block btn-warning disabled">
        {{ stats.draft }} {% trans "Unconfirmed" %} <i data-feather="circle"></i>
       </span>
    </div>
    <div class="col-md-3 col-12">
      <span class="btn btn-block btn-success disabled">
        {{ stats.confirmed }} {% trans "Confirmed" %} <i data-feather="check"></i>
       </span>
    </div>
    {% if pref.enable_postponements %}
      <div class="col-md-3 col-12">
        <span class="btn btn-block btn-primary disabled">
          {{ stats.postponed }} {% trans "Postponed" %} <i data-feather="pause"></i>
         </span>
      </div>
      <div class="col-md-3 col-12">
        <span class="btn btn-block btn-primary disabled">
          {% trans "Byes" %} <span class="icon fast-forward"></span>
         </span>
      </div>
    {% endif %}
  </div>

  {{ block.super }}

  <form id="postponeForm" action="{% roundurl 'results-postpone-debate' %}" method="POST">
    <input type="hidden" id="postpone_debate_id" name="debate_id" />
  </form>

  <form id="unpostponeForm" action="{% roundurl 'results-unpostpone-debate' %}" method="POST">
    <input type="hidden" id="unpostpone_debate_id" name="debate_id" />
  </form>

{% endblock content %}

{% block js %}

  {{ block.super }}

  <script>
    $(document).ready( function() {

      $(".postpone-link").each(function () {
        $(this).click( function() {
          var debate_id = $(this).attr("debate-id");
          $("#postpone_debate_id").val(debate_id);
          $("#postponeForm").submit();
          $(this).html("<i>{% trans "Postponingâ€¦" %}</i>");
          return false;
        });
      });

      $(".unpostpone-link").each( function() {
        $(this).click( function() {
          var debate_id = $(this).attr("debate-id");
          $("#unpostpone_debate_id").val(debate_id);
          $("#unpostponeForm").submit();
          $(this).html("<i>{% trans "Unpostponingâ€¦" %}</i>");
          return false;
        });
      });

    });
  </script>
{% endblock %}
