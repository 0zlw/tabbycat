{% extends "base_vue_table.html" %}
{% load humanize %}
{% load debate_tags %}

{% block page-title %}Enter Results for {{ round.name }}{% endblock %}
{% block head-title %}<span class="emoji">ðŸ“©</span>Enter Results{% endblock %}
{% block sub-title %}for {{ round.name }}{% endblock %}

{% block page-subnav-sections %}
  {% if user.is_superuser %}
    <a href="{% roundurl 'motions-edit' %}" class="btn btn-outline-primary">
      <i data-feather="chevron-left"></i> Back to Motions
    </a>
    <a class="btn btn-outline-primary " href="{% roundurl 'results-ballot-checkin' round %}">
      Check In Ballots
    </a>
  {% endif %}

{% endblock %}

{% block page-subnav-actions %}
  {% if user.is_superuser and round.seq < tournament.round_set.count and current_round == round %}
    <a class="btn {% if stats.none == 0 and stats.draft == 0  %}btn-success{% else %}btn-danger disabled{% endif %} " href="{% roundurl 'tournament-advance-round-check' %}">
      Advance to Next Round <i data-feather="chevron-right"></i>
    </a>
  {% endif %}
{% endblock %}

{% block page-alerts %}
  {% if not has_motions %}
    <div class="alert alert-danger">
      Currently there are no motions entered for this round, so debate results
      cannot be entered. <a href="{% roundurl 'motions-edit' current_round %}" class="alert-link">Add Motions.</a>
    </div>
  {% endif %}
  {% with even_panel=round.num_debates_with_even_panel %}
    {% if even_panel > 0 %}
      <div class="alert alert-warning">
        {{ even_panel|apnumber|capfirst }} debate{{ even_panel|pluralize:" has a panel,s have panels" }} with an even number of voting adjudicators. If the adjudicators split evenly, the debate will be awarded to the team for which the chair voted.
      </div>
    {% endif %}
  {% endwith %}
{% endblock %}

{% block content %}

  <div class="row mb-4">

    <div class="col-3">
      <span class="btn btn-block btn-primary disabled">
        {{ stats.ballot_in }} Checked In <i data-feather="inbox"></i>
      </span>
    </div>
    <div class="col-3">
      <span class="btn btn-block btn-danger disabled">
        {{ stats.none }} Unknown <i data-feather="x"></i>
       </span>
    </div>
    <div class="col-3">
      <span class="btn btn-block btn-warning disabled">
        {{ stats.draft }} Unconfirmed <i data-feather="circle"></i>
       </span>
    </div>
    <div class="col-3">
      <span class="btn btn-block btn-success disabled">
        {{ stats.confirmed }} Confirmed <i data-feather="check"></i>
       </span>
    </div>
    {% if pref.enable_postponements %}
      <div class="col-3">
        <span class="btn btn-block btn-primary disabled">
          {{ stats.postponed }} Postponed <i data-feather="pause"></i>
         </span>
      </div>
      <div class="col-3">
        <span class="btn btn-block btn-primary disabled">
          Byes <span class="icon fast-forward"></span>
         </span>
      </div>
    {% endif %}
  </div>

  {{ block.super }}

  <form id="postponeForm" action="{% roundurl 'results-postpone-debate' %}" method="POST">
    <input type="hidden" id="postpone_debate_id" name="debate_id" />
  </form>

  <form id="unpostponeForm" action="{% roundurl 'results-unpostpone-debate' %}" method="POST">
    <input type="hidden" id="unpostpone_debate_id" name="debate_id" />
  </form>

{% endblock content %}

{% block js %}

  {{ block.super }}

  <script>
    $(document).ready( function() {

      $(".postpone-link").each(function () {
        $(this).click( function() {
          var debate_id = $(this).attr("debate-id");
          $("#postpone_debate_id").val(debate_id);
          $("#postponeForm").submit();
          $(this).html("<i>Postponingâ€¦</i>");
          return false;
        });
      });

      $(".unpostpone-link").each( function() {
        $(this).click( function() {
          var debate_id = $(this).attr("debate-id");
          $("#unpostpone_debate_id").val(debate_id);
          $("#unpostponeForm").submit();
          $(this).html("<i>Unpostponingâ€¦</i>");
          return false;
        });
      });

    });
  </script>
{% endblock %}
