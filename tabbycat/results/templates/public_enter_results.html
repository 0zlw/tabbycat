{% extends "base.html" %}
{% load debate_tags add_field_css humanize static i18n %}


{% block page-title %}{% blocktrans trimmed with matchup=debate.matchup %}
  Enter Results for {{ matchup }}
{% endblocktrans %}{% endblock %}
{% block head-title %}{% blocktrans trimmed with matchup=debate.matchup %}
  Enter Results for {{ matchup }}
{% endblocktrans %}{% endblock %}
{% block extra-head %}<meta name="robots" content="noindex" />{% endblock %}

{% block sub-title %}
  {% blocktrans trimmed with round=debate.round.name venue_category=debate.division.venue_category.name venue=debate.venue.display_name %}
    {{ round }} @ {{ venue_category }} {{ venue }}
  {% endblocktrans %}
{% endblock %}

{% block content %}

  {% if form.scoresheets|length > 1 %}
    <div class="alert alert-warning">
      {% blocktrans trimmed with adj_name=adjudicator.name %}
        {{ adj_name }}, note that you must enter <strong>all of the ballots</strong> from your panel, not just your own!
      {% endblocktrans %}
    </div>
  {% endif %}

  {% with nballotsubs=all_ballotsubs.count %}
    {% if nballotsubs > 0 %}
      <div class="alert alert-danger">
        {% blocktrans trimmed with nsubmissions=nballotsubs|apnumber count counter=nballotsubs %}
          This form has already been submitted <strong>once</strong>. Please contact a tab official after submitting your form.
        {% plural %}
          This form has already been submitted <strong>{{ nsubmissions }}</strong> times. Please contact a tab official after submitting your form.
        {% endblocktrans %}
      </div>
    {% endif %}
  {% endwith %}

  <form id="resultsForm" action="." method="POST" class="">
    {% csrf_token %}
    {% include "ballot/ballot_set.html" %}

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="panel-heading">
            <h4 class="panel-title">
              {% trans "Submit" context "box title" %}
            </h4>
          </div>
          <div class="card-body">
            {# Password isn't always used. #}
            {% if form.password %}
              <div class="form-group">
                <label for="{{ form.password.id_for_label }}">{{ form.password.label }}</label>
                <div class="col-sm-9 col-md-6">
                  {{form.password}}
                </div>
                <div class="col-md-2 col-xs-10 ">
                  {% if form.password.errors %}
                    <label for="{{ form.password.id_for_label }}" >{{ form.password.errors }}</label>
                  {% endif %}
                </div>
              </div>
            {% endif %}
            <input id="id_debate_result_status" type="hidden" name="debate_result_status" value="{{ debate.STATUS_DRAFT }}" />
            <input id="id_discarded" type="hidden" name="discarded" />
            <input id="id_confirmed" type="hidden" name="confirmed" />
            <input class="save btn btn-success btn-block " type="submit" value="Submit Ballot(s)" tabindex="{{ form.nexttabindex }}" data-loading-text="Submitting..."/>
          </div>
        </div>
      </div>
    </div>
  </form>
{% endblock content %}

{% block js %}

  {{ block.super }}
  <!-- TODO: bundle -->
  <script src="{% static 'js/vendor/jquery.validate.js' %}"></script>
  <script>
    $(document).ready( function() {
      {% include "js-standalones/enter_results.js" %}
    });
  </script>
{% endblock %}
