{% extends "base.html" %}
{% load debate_tags %}

{% block page-subnav-sections %}
  {% include "tables/table_search.html" %}
{% endblock %}

{% block content %}

  {% for table_index in tables_count %}
    {% if tables_count|length > 1 %}<div class="col-md-{% divide_to_int 12 tables_count|length %}">{% endif %}

      <div class="panel panel-default" id="tableContainer{{ table_index }}">
        <div class="panel-heading" v-if="tableTitle">
          <h4>[[ tableTitle ]]</h4>
        </div>
        <div class="panel-body">
          <smart-table
            :table-content="gridData"
            :filter-key="searchQuery"
            :default-sort-key="sortKey">
          </smart-table>
        </div>
      </div>

    {% if tables_count|length > 1 %}</div>{% endif %}
  {% endfor %}

{% endblock content %}

{% block extra-js %}
  {{ block.super }}
  {% include "vue/table.vue" %}
  <script>

    var tablesCount = {{ tables_count }};
    var tablesData = {{ tables_data|safe }};
    var tablesSort = '{{ tables_sort }}';
    var tablesTitles = {{ tables_titles|safe }};
    var tablesVue = [];

    for (var tableIndex in tablesCount) {
      tablesVue.push(
        new Vue({
          el: String('#tableContainer' + tableIndex),
          data: {
            searchQuery: '',
            gridData: tablesData[tableIndex],
            sortKey: tablesSort,
            tableTitle: tablesTitles[tableIndex],
          },
          ready: function() {
            var thisTable = this; // this in the next context is the element
            document.getElementById('table-search').onkeyup = function (e) {
              thisTable.$set('searchQuery', this.value);
            }
          },
        })
      );
    }


  </script>
{% endblock extra-js %}