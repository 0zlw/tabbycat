{% extends "base.html" %}
{% load debate_tags %}

{% block extra-head %}
<script type="text/javascript">
    $(document).ready( function() {
        $('.table').dataTable({
            'bPaginate': false,
            "aaSorting": [[ 0, "desc" ]],
        });

    // the standard header to be re-added to the modal
    var tableHead = '<table id="modal-adj-table" class="table table-bordered"><thead><th><span class="glyphicon glyphicon-time" data-toggle="tooltip" title="Round"></span></th><th><span class="glyphicon glyphicon-sort" data-toggle="tooltip" title="Bracket"></span></th><th>Debate</th><th>Source</th><th>Score</th><th>Comments</th></tr><thead><tbody><tbody><table>'

    $(".view-feedback").each( function() {
        $(this).click( function() {

            var adj_row = $(this).parent().parent() // the <tr> for this adjudicator in the table
            var adj_name = adj_row.find(".adj-name").text()
            var adj_id = parseInt(adj_row.attr('id').split('_')[1]) // the id of the adjudicator object

            $("#modal-adj-table_wrapper").remove(); // removing the previously loaded table
            $("#modal-adj-name").text(adj_name); // Updating header of the modal
            $(".modal-body").append(tableHead);
            $("#modal-adj-table").dataTable({
              // Grabbing the adj data into a datatable
              'sAjaxSource': '{% tournament_url get_adj_feedback %}?id=' + adj_id,
              'bPaginate': false,
            });

        });
    });
});
</script>
{% endblock extra-head %}

{% block body_class %}draw-public-display{% endblock %}

{% block h1 %}The Wall of Shame{% endblock %}

{% block content %}
    <table id="dataTable" class="table table-hover table-bordered table-striped">
        <thead>
            <tr>
                <th><span class="glyphicon glyphicon-remove" data-toggle="tooltip" title="Uncompleted Ballots"></span></th>
                <th>Type</th>
                <th>Offendor</th>
                <th>Institution</th>
                <th>Missing Ballots</th>
            </tr>
        </thead>
        <tbody>

        {% for entity in adjudicators %}
        <tr id="adj_{{ entity.id }}">
            <td class="">
                {{ entity.owed_ballots }} / {{ entity.total_ballots }}
            </td>
            <td>
                Adj
            </td>
            <td class="entity-name">{{ entity.name }}</td>
                {{ entity.name }}
            </td>
            <td class="">
                {{ entity.institution }}
            </td>
            <td title="" class="" id="">
                <a data-toggle="modal" data-target="#adj-feedback"  class="view-feedback">View Missing Feedback</a>
            </td>
        </tr>
        {% endfor %}

        {% for team in teams %}
        <tr id="team_{{ team.id }}">
            <td class="">
                {{ team.owed_ballots }} / {{ team.total_ballots }}
            </td>
            <td>
                Team
            </td>
            <td>
                <a title="{{ team.speakers|join:", " }}" id="team_{{ team.id }}" data-toggle="tooltip" class="team" href="#">
                    {{ team.name }}
                </a>
            </td>
            <td class="">
                {{ team.institution }}
            </td>
            <td title="" class="" id="">
                <a data-toggle="modal" data-target="#adj-feedback"  class="view-feedback">View Missing Feedback</a>
            </td>
        </tr>
        {% endfor %}


        </tbody>
    </table>

<div class="modal fade" id="adj-feedback" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header"><h3>Missing Feedback for <span id="modal-adj-name"></span></h3></div>
        <div class="modal-body">
<!-- <table id="modal-adj-table" class="table table-bordered">
    <thead>
        <th><span class="glyphicon glyphicon-time" data-toggle="tooltip" title="Round"></span></th>
        <th><span class="glyphicon glyphicon-sort" data-toggle="tooltip" title="Bracket"></span></th>
        <th>Debate</th><th>Source</th><th>Score</th><th>Comments</th></tr>
    </thead>
    <tbody>
    </tbody>
</table> -->
        </div>
    </div>
  </div>
</div>

{% endblock content %}
