{% extends "base.html" %}

{% block extra-head %}
    <script type="text/javascript" charset="utf-8">
        function intId(elem) {
            return parseInt($(elem).attr("id").split('_')[1]);
        }

        function details(nTr) {
            var s = '<table id="feedback_' + intId(nTr) + '" cellpadding="0" cellspacing="0" class="display"><thead>';
            s += '<tr><th>Rnd</th><th>Brkt</th><th>Debate</th><th>Source</th><th>Score</th><th>Comments</th></tr>';
            s += '</thead><tbody></tbody></table>';

            return s;
        }

        var dTable;
        $(document).ready( function() {
            dTable = $('#dataTable').dataTable({
                'bPaginate': false
            });

            $("#dataTable a.view").each( function() {
                $(this).click( function() {
                    var nTr = this.parentNode.parentNode;

                    if ($(this).html().match('View')) {
                        dTable.fnOpen(nTr, details(nTr), 'details');

                        var feedTable = $("#feedback_" + intId(nTr)).dataTable( {
                            'bProcessing': true,
                            'sAjaxSource': '{% url get_adj_feedback %}?id=' + intId(nTr),

                            'bPaginate': false
                        });

                        $(this).html("Hide Feedback");
                    } else {
                        dTable.fnClose(nTr);
                        $(this).html("View Feedback");
                    }

                    return false;

                } );
            } );


        } );
    </script>
{% endblock %}

{% block extra-style %}
        @import "/static/css/demo_table.css";

        #dataTable td.details {
            background-color: #fff;
        }
{% endblock extra-style %}

{% block content %}
<table id="dataTable" class="display" cellpadding="0", cellspacing="0">
    <thead>
        <tr>
            <th>Name</th>
            <th>Institution</th>
            <th>Test Score</th>
            <th>Score</th>
            <th>View</th>
            <th>Add</th>
        </tr>
    </thead>

    <tbody>
        {% for adj in adjudicators %}
        <tr id="adj_{{ adj.id }}">
            <td>{{ adj.name }}</td>
            <td>{{ adj.institution }}</td>
            <td>{{ adj.test_score }}</td>
            <td>{{ adj.score }}</td>
            <td><a class="view" href="">View Feedback</a></td>
            <td><a href="{% url enter_feedback adj.id %}">Add Feedback</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock content %}



