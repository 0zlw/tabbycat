{% extends "base.html" %}
{% load debate_tags %}

{% block page-title %}{{ round.name }} Check-Ins{% endblock %}
{% block head-title %}<span class="emoji">üìç</span>Ô∏èCheck-Ins Overview{% endblock %}
{% block sub-title %}For {{ round.name }}{% endblock %}

{% block page-subnav-sections %}
  <a class="btn btn-default submit-disable" href="{% round_url team_availability round %}">
    Check In Teams
  </a>
  <a class="btn btn-default submit-disable" href="{% round_url venue_availability round %}">
    Check In Venues
  </a>
  <a class="btn btn-default submit-disable" href="{% round_url adjudicator_availability round %}">
    Check In Adjudicators
  </a>

  <a class="btn btn-default submit-disable" href="{% round_url update_availability_all round %}">
    Check In All
  </a>
  {% if round.prev %}
    <a class="btn btn-default submit-disable" href="{% round_url update_availability_previous round %}">
      Check In All Active in {{ round.prev.abbreviation }}
    </a>
  {% endif %}

{% endblock %}

{% block page-subnav-actions %}

  {% if previous_unconfirmed %}
    <button class="btn btn-warning" id="createDraw"
      data-toggle="tooltip" title="{{ previous_unconfirmed }} debates from
      {{ round.prev.name }} do not have a completed ballot ‚Äî
      this may lead to a draw that fails or is incorrect">
    {% elif checkin_types.0.in_now == 0 %}
      <button class="btn btn-danger submit-disable disabled"
      data-toggle="tooltip" title="The draw cannot be generated until some
      teams have been checked in">
    {% elif checkin_types.1.in_now == 0 %}
      <button class="btn btn-danger submit-disable disabled"
      data-toggle="tooltip" title="The draw cannot be generated until some
      adjudicators have been checked in">
    {% elif checkin_types.2.in_now == 0 %}
      <button class="btn btn-danger submit-disable disabled"
      data-toggle="tooltip" title="The draw cannot be generated until some
      venues have been checked in">
  {% elif min_venues > checkin_types.2.in_now %}
    <button class="btn btn-warning" id="createDraw"
      data-toggle="tooltip" title="There are too few checked in venues available
       for the amount of debates ‚Äî the draw may not generate properly.">
  {% elif min_adjudicators > checkin_types.1.in_now %}
    <button class="btn btn-warning" id="createDraw"
      data-toggle="tooltip" title="There are too few checked in adjudicators
      available for the amount of debates ‚Äî the draw may not generate properly">
  {% elif not checkin_types.0.in_now|divisibleby:2  %}
    <button class="btn btn-warning" id="createDraw"
      data-toggle="tooltip" title="There is an uneven number of teams checked in
       for this round ‚Äî the draw may not generate properly">
  {% else %}
    {% if round.draw_status != round.STATUS_NONE %}
      <a class="btn btn-success submit-disable" href="{% round_url draw round %}">
    {% else %}
      <button class="btn btn-success submit-disable" id="createDraw">
    {% endif %}
  {% endif %}

  {% if round.draw_status == round.STATUS_CONFIRMED or round.draw_status = round.STATUS_RELEASED %}
    View Draw <span class="glyphicon glyphicon-chevron-right"></span>
  </a>
  {% else %}
    Generate Draw <span class="glyphicon glyphicon-chevron-right"></span>
  </button>
  {% endif %}

  <form id="createForm" action="{% round_url create_draw %}" method="POST"></form>

{% endblock %}

{% block page-alerts %}

  {% if previous_unconfirmed > 0  %}
    <div class="alert alert-danger">
      Note: {{ previous_unconfirmed }} debates from <strong>{{ round.prev.name }}
       do not have a completed ballot</strong> ‚Äî this may lead to a draw that fails or is incorrect <em>depending</em> on your draw rules.
    </div>
  {% endif %}

  {% if not checkin_types.0.in_now|divisibleby:2  %}
    <div class="alert alert-danger">
      There is an uneven number of teams checked in for this round.
    </div>
  {% endif %}

  {% if min_adjudicators > checkin_types.1.in_now %}
    <div class="alert alert-warning">
      There need to be at least {{ min_adjudicators }} checked in adjudicators given the number of debates.
    </div>
  {% endif %}

  {% if min_venues > checkin_types.2.in_now %}
    <div class="alert alert-warning">
      There need to be at least {{ min_venues }} checked in venues given the number of debates.
    </div>
  {% endif %}

{% endblock %}

{% block content %}

<div class="row">
  <div class="col-md-12">

    {% for checkin_type in checkin_types %}
      {% include 'checkin_progress.html' %}
    {% endfor %}

  </div>
</div>
{% endblock content %}

{% block extra-js %}
  <script>

    $(document).ready( function() {
      $("#createDraw").click( function() {
        $("#createForm").submit();
        return false;
      } );
    } );

  </script>
{% endblock extra-js %}
