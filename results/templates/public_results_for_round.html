{% extends "base.html" %}
{% load static %}
{% load debate_tags %}

{% block head-title %}<span class="emoji">ðŸ’¥</span>Results for {{ round.name }}{% endblock %}
{% block page-title %}ðŸ’¥Results for {{ round.name }}{% endblock %}
{% block page-subnav-sections %}{% include "tables/table_search.html" %}{% endblock %}

{% block content %}

<div class="panel panel-default">
  <div class="panel-body" id="resultsTableContainer">
    <smart-table :data="gridData" :filter-key="searchQuery"></smart-table>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-body">
    <table id="dataTable" class="table">
    <thead>
      <tr>
        {% if pref.enable_divisions %}
          <th><span class="glyphicon glyphicon-th-list" data-toggle="tooltip" title="" data-original-title="Division"></span></th>
        {% endif %}
        <th><span class="glyphicon glyphicon-map-marker" data-toggle="tooltip"title="Venue"></span></th>
        {% if pref.ballots_released %}<th>Ballots</th>{% endif %}
        {% if pref.show_emoji %}
          <th class="team-emoji"></th>
        {% endif %}
        <th>Aff<span class="hidden-xs">irmative</span></th>
        {% if pref.show_emoji %}
          <th class="team-emoji"></th>
        {% endif %}
        <th>Neg<span class="hidden-xs">ative</span></th>
        <th>Adj<span class="hidden-xs">udicator</span>s</th>
        {% if show_motions_column %}
          <th>M<span class="hidden-xs">otion</span></th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
    {% for debate in draw %}
      <tr>
        {% if pref.enable_divisions %}
          <td>{{ debate.division.name }}</td>
        {% endif %}
        <td>{% if debate.venue %}{{ debate.venue.name }}{% endif %}</td>
        {% if pref.ballots_released %}
          <td>
            {% if debate.confirmed_ballot %}
              <a href="{% tournament_url public_ballots_view debate.id %}">View Ballots</a>
            {% else %}
              No result
            {% endif %}
          </td>
        {% endif %}
        {% if pref.show_emoji %}
          <td class="team-emoji"><span class="emoji">{{ debate.aff_team.emoji }}</span></td>
        {% endif %}
        <td>
          {% if debate.confirmed_ballot.ballot_set.aff_win == 1 %}
            <span class="glyphicon glyphicon-arrow-up text-success"></span>
          {% elif debate.confirmed_ballot.ballot_set.neg_win == 1 %}
            <span class="glyphicon glyphicon-arrow-down text-danger"></span>
          {% endif %}
          {% include "tables/team.html" with team=debate.aff_team %}
        </td>
        {% if pref.show_emoji %}
          <td class="team-emoji"><span class="emoji">{{ debate.neg_team.emoji }}</span></td>
        {% endif %}
        <td>
          {% if debate.confirmed_ballot.ballot_set.neg_win == 1 %}
            <span class="glyphicon glyphicon-arrow-up text-success"></span>
          {% elif debate.confirmed_ballot.ballot_set.aff_win == 1 %}
            <span class="glyphicon glyphicon glyphicon-arrow-down text-danger"></span>
          {% endif %}
          {% include "tables/team.html" with team=debate.neg_team %}
        </td>
        <td>
          {% if debate.confirmed_ballot and pref.show_splitting_adjudicators %}
            {% for type, adj, split in debate.confirmed_ballot.ballot_set.adjudicator_results %}
              {% if split %}
                <span class="text-danger">{{ adj.name }}{% if type == 'C' and debate.adjudicators.is_panel %} (c){% elif type == 'T' %} (t){% endif %}</span> <span class="glyphicon glyphicon-resize-full text-danger"></span>{% if not forloop.last %},{% endif %}
              {% else %}
                {{ adj.name }}{% if type == 'C' and debate.adjudicators.is_panel %} (c){% elif type == 'T' %} (t){% endif %}{% if not forloop.last %},{% endif %}
              {% endif %}
            {% endfor %}
          {% else %}
            {% for type, adj in debate.adjudicators %}
              {{ adj.name }}{% if type == 'C' and debate.adjudicators.is_panel %} (c){% elif type == 'T' %} (t){% endif %}{% if not forloop.last %},{% endif %}
            {% endfor %}
          {% endif %}
        </td>
        {% if show_motions_column %}
          <td>
            <span data-toggle="tooltip" title="{{ debate.confirmed_ballot.motion }}">
            {{ debate.confirmed_ballot.motion.reference }}
            </span>
          </td>
        {% endif %}

      </tr>
    {% endfor %}
  </table>
  </div>
</div>
{% endblock content %}

{% block extra-js %}
  {{ block.super }}
  {% include "vue/table.vue" %}
  <script>
    var resultsTable = new Vue({
      el: '#resultsTableContainer',
      data: {
        searchQuery: '',
        gridData: {{ resultsTableData|safe }},
      },
    });
  </script>
{% endblock extra-js %}
